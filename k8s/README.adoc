=== Install Metallb

* kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.5/manifests/namespace.yaml
* kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.5/manifests/metallb.yaml
* kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey="$(openssl rand -base64 128)"
* kubectl apply -f metallb.yaml

=== Install traefik

* kubectl create namespace traefik
* helm repo add traefik https://helm.traefik.io/traefik
* helm repo update
* kubectl apply -f traefik-config.yaml
* helm install traefik traefik/traefik --namespace=traefik --values=traefik-chart-values.yaml
* wait for kubectl get pods --all-namespaces to complete

=== Install cert-manager

* kubectl create namespace cert-manager
* helm repo add jetstack https://charts.jetstack.io
* helm repo update
* helm install cert-manager jetstack/cert-manager --namespace cert-manager --version v1.2.0 --create-namespace --set installCRDs=true --set 'extraArgs={--dns01-recursive-nameservers-only,--dns01-recursive-nameservers=8.8.8.8:53}'
* helm repo add smueller18 https://smueller18.gitlab.io/helm-charts
* helm repo update
* helm install --namespace cert-manager cert-manager-webhook-inwx smueller18/cert-manager-webhook-inwx
* kubectl apply -f issuer-secret.yaml
* kubectl apply -f certmanager-issuer.yaml
* helm upgrade cert-manager jetstack/cert-manager --namespace cert-manager --reuse-values --set ingressShim.defaultIssuerName=letsencrypt-prod --set ingressShim.defaultIssuerKind=ClusterIssuer --set ingressShim.defaultIssuerGroup=cert-manager.io

=== Install default cert

* kubectl apply -f default-cert.yaml

=== install treafik ingress

* kubectl apply  -f traefik-auth.yaml
* kubectl apply -f traefik-ingress.yaml

=== Install Rancher

* kubectl create namespace cattle-system
* kubectl apply -f rancher-cert.yaml
* helm repo add rancher-latest https://releases.rancher.com/server-charts/latest
* helm repo update
* helm install rancher rancher-latest/rancher --namespace cattle-system --values=rancher-chart-values.yaml

=== Install Longhorn

* helm repo add longhorn https://charts.longhorn.io
* helm repo update
* kubectl create namespace longhorn-system
* kubectl apply  -f longhorn-auth.yaml
* kubectl apply  -f longhorn-middleware.yaml
* helm install longhorn longhorn/longhorn --namespace longhorn-system --values=longhorn-chart-values.yaml
* kubectl patch storageclass local-path -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"false"}}}'
* kubectl apply -f longhorn-storageclass.yaml 

=== Ingress for legacy Services

* kubectl apply -f legacy-proxy.yaml

=== Display service

* kubectl apply -f display.yaml

=== Unifi Controller

* helm repo add k8s-at-home https://k8s-at-home.com/charts/
* helm repo update 
* helm install unifi k8s-at-home/unifi -f unifi-chart-values.yaml
